<html>
<head>
    <meta charset="utf-8">
    <meta name=viewport content="width=device-width, initial-scale=1">

    <link rel=stylesheet href="stylesheet.css">
    <title>Værvarsel</title>
</head>
<body onload="onload();">

<style>
	
body{
font-family: arial,sans-serif;
color:white;
margin-left:10px;
}
#idagnum{
font-size: 68px;
float:left;

margin-right:5px;
}
h1{
margin-bottom:1px;
}

.dag{
	font-size: 13px;
	text-align:center;
	background-color:#EEE;
	margin-right:5px;
	margin-bottom:5px;
	float:left;
	width:65px;
	height:85px;
	padding:5px;
}


#ikonnaa{
float:left;

}
#gradernaa{
margin-left:10px;
float:right;
	padding-top:20px;
	color:#333;
}
#laster{
text-align: center;

}
#vaerikonnaa{
float:left;

width:100px;
}
#gradernaa{
float:left;
font-size: 64px;

width:50px;
}

#dagenstekst{
	width:400px;
margin:10px;
padding-top:10px;
font-size: 14px;
clear:both;
}

#ikonoggrader{

	width:600px;

}

#melding{
	width:50%;
margin: 0 auto;

}
</style>

<div class="overlay">
        <div class="main-wrapper">
            <div id="sokWrapper">
                <a href="http://localhost:8888/INF329-XML/"><h1>Værvarsel</h1></a>
                <form autocomplete="off" name="stedsok" onsubmit="return sjekk()">
                <input type="hidden" id="formStedstype" name="stedstype" value="" />
                    <input type="search" name="sok" id="sok" placeholder="søk" onkeyup="searchDivs(this.value, event)">
                    <div id="instantsearch"></div>
                </form>
            </div>
         <div id="melding">
	<h1 id="overskrift"></h1>
	<span id="dagensdato"></span>

	<div id="ikonoggrader">
		<div id="vaerikonnaa"></div>
		<div id="gradernaa"></div>
	</div>

	<p id="dagenstekst"></p>

<div id="dagvarsel"></div>
</div>
<span id="laster"></span>
        </div>
    </div>
    <script type="text/javascript" src="search.js"></script>
    <script type="text/javascript" src="javascript.js"></script>

<script>
var liste;
function getUrlVars() {
var vars = {};
var parts = window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi, function(m,key,value) {
vars[key] = value;
});
return vars;
}

function onload(){
var xmlhttp = new XMLHttpRequest();
var url = "readfile.php";

xmlhttp.onreadystatechange = function() {
    if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
         liste = JSON.parse(xmlhttp.responseText);

 var sokeord = getUrlVars()["sok"];
 var stedstype = getUrlVars()["stedstype"];
var ut = simpleSearch2(sokeord, stedstype)

getMelding(ut);

    }
}
xmlhttp.open("GET", url, true);
xmlhttp.send();
}

function getMelding(StedObj){
var ukedag = new Array(7);
ukedag[0]=  "Søndag";
ukedag[1] = "Mandag";
ukedag[2] = "Tirsdag";
ukedag[3] = "Onsdag";
ukedag[4] = "Torsdag";
ukedag[5] = "Fredag";
ukedag[6] = "Lørdag";

var http = new XMLHttpRequest();
var url = "nyxml.php";

http.onreadystatechange = function() {
    if (http.readyState == 4 && http.status == 200) {
    	document.getElementById("laster").innerHTML = ''; 
        liste = JSON.parse(http.responseText);

        //Overskrift
        document.getElementById("overskrift").innerHTML = liste.stedsnavn;

        //Dagens dato (navn)
        var dagensdato = new Date(liste.melding.detaljert.tidspunkt[0]["@attributes"].fratid);
        document.getElementById("dagensdato").innerHTML = ukedag[dagensdato.getDay()];
        //Dagens tekstvarsel
       document.getElementById("vaerikonnaa").innerHTML = "<img src='b100/" + liste.melding.detaljert.tidspunkt[0].symbol["@attributes"].nr + ".png'/>";
       document.getElementById("gradernaa").innerHTML = liste.melding.detaljert.tidspunkt[0].temperatur;
  	   document.getElementById("dagenstekst").innerHTML = liste.melding.tekst.tidspunkt[0].tekst;
var utTekst = "";
for ( var i = 0; i < liste.melding.detaljert.tidspunkt.length; i++) {
		var obj = liste.melding.detaljert.tidspunkt[i];
		if (obj["@attributes"].periode == 2){
		divstart = "<div class='dag'>";
		divslutt ="</div>";
		fratid = new Date(obj["@attributes"].fratid);
  	 	dagsymbol = "<img src='b38/"+obj.symbol["@attributes"].nr +".png'><br>"
  	 	daggrader = obj.temperatur + "&#8451;";
  	 	utTekst += divstart + fratid.getDate() + "<br>" + dagsymbol + daggrader + divslutt;
  	 }

  	 }
  	 document.getElementById("dagvarsel").innerHTML = utTekst;
  
    }
}


document.getElementById("laster").innerHTML = '<img src="laster.gif" /><br>Laster inn værmeldingen';
http.open("GET", url+"?url="+StedObj.url, true);
http.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
http.send(null);
}
</script>

</body>
</html>